/*
 * File: js/app/view/tree/Abstract.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('App.view.tree.Abstract', {
    extend: 'Ext.tree.Panel',

    displayField: 'title',
    rootVisible: false,

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            viewConfig: {
                rootVisible: false,
                plugins: [
                    Ext.create('Ext.tree.plugin.TreeViewDragDrop', {
                        ptype: 'treeviewdragdrop'
                    })
                ],
                listeners: {
                    beforedrop: {
                        fn: me.onTreedragdroppluginBeforeDrop,
                        scope: me
                    }
                }
            },
            selModel: Ext.create('Ext.selection.RowModel', {
                ignoreRightMouseSelection: true
            })
        });

        me.callParent(arguments);
    },

    onTreedragdroppluginBeforeDrop: function(node, data, overModel, dropPosition, dropFunction, options) {
        return true;
    },

    onCategoryTreeBeforeItemDblClick: function(tablepanel, record, item, index, e, options) {
        var store = Ext.getStore("Tree.FeatureGroup");
        //var hiddenStore = Ext.getStore("HiddenFeaturesTreeStore");
        //var visibleStore = Ext.getStore("VisibleFeaturesTreeStore");
        var selection = Ext.getCmp("categoryTree").getSelectionModel().getSelection();

        store.getProxy().extraParams.params = { category: selection[0].data.uid };

        //hiddenStore.getProxy().extraParams.pid = selection[0].data.uid;
        //hiddenStore.getProxy().extraParams.hidden = 1;

        //visibleStore.getProxy().extraParams.pid = selection[0].data.uid;
        //visibleStore.getProxy().extraParams.visible = 1;

        // BUG: Twice loading here. After first window creating ldata oading starts automatically (but autoLoad: false)
        store.load();
        //hiddenStore.load();
        //visibleStore.load();



        var categoryFeaturesWindow = Ext.create('App.view.CategoryFeaturesWindow');
        //Ext.create('App.store.FeatureTreeStore');
        categoryFeaturesWindow.setTitle('Характеристики категории: '+selection[0].data.title+' ['+selection[0].data.uid+']');
        categoryFeaturesWindow.show();
        return false;
    }

});